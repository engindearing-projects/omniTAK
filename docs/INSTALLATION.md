# OmniTAK Installation Guide

This guide covers all methods for installing OmniTAK on your system.

## Table of Contents

- [Quick Install (Recommended)](#quick-install-recommended)
- [Installation Methods](#installation-methods)
  - [Shell Script Installer](#shell-script-installer)
  - [cargo-dist Installer](#cargo-dist-installer)
  - [Manual Installation](#manual-installation)
  - [Build from Source](#build-from-source)
- [Verification](#verification)
- [Uninstallation](#uninstallation)
- [Troubleshooting](#troubleshooting)

## Quick Install (Recommended)

### Linux and macOS

The fastest way to get started:

```bash
# Using cargo-dist installer (recommended)
curl --proto '=https' --tlsv1.2 -LsSf \
  https://github.com/engindearing-projects/omniTAK/releases/latest/download/omnitak-installer.sh | sh

# Or using our custom installer
curl -fsSL https://raw.githubusercontent.com/engindearing-projects/omniTAK/main/scripts/install.sh | bash
```

### Windows

```powershell
# Using cargo-dist PowerShell installer
irm https://github.com/engindearing-projects/omniTAK/releases/latest/download/omnitak-installer.ps1 | iex
```

## Installation Methods

### Shell Script Installer

Our custom shell installer provides a simple, straightforward installation process for Linux and macOS.

#### Features

- ✅ Automatic OS and architecture detection
- ✅ Downloads latest or specific version
- ✅ Installs both `omnitak` and `omnitak-adb-setup`
- ✅ SHA256 checksum verification
- ✅ Supports sudo and non-sudo installations
- ✅ Clear progress indicators and error messages

#### Usage

**Install Latest Version:**

```bash
curl -fsSL https://raw.githubusercontent.com/engindearing-projects/omniTAK/main/scripts/install.sh | bash
```

**Download and Run:**

```bash
# Download the installer
curl -fsSL https://raw.githubusercontent.com/engindearing-projects/omniTAK/main/scripts/install.sh -o install.sh

# Make it executable
chmod +x install.sh

# Run the installer
./install.sh
```

**Install Specific Version:**

```bash
./install.sh --version v0.2.0
```

**Show Help:**

```bash
./install.sh --help
```

#### Installation Locations

The installer will try to install binaries in the following order:

1. `/usr/local/bin` - If you have write access or sudo
2. `~/.local/bin` - If no sudo access is available

If installing to `~/.local/bin`, make sure it's in your PATH:

```bash
# Add to ~/.bashrc or ~/.zshrc
export PATH="$HOME/.local/bin:$PATH"
```

#### Supported Platforms

- **Linux**
  - x86_64 (64-bit Intel/AMD)
  - aarch64 (64-bit ARM, e.g., Raspberry Pi 4)

- **macOS**
  - x86_64 (Intel Macs)
  - aarch64 (Apple Silicon M1/M2/M3)

#### Requirements

The installer needs these tools (usually pre-installed):
- `curl` or `wget` - For downloading
- `tar` - For extracting archives
- `sha256sum` or `shasum` - For checksum verification (optional)

### cargo-dist Installer

The official installer generated by cargo-dist provides additional features like version management.

#### Linux and macOS

```bash
curl --proto '=https' --tlsv1.2 -LsSf \
  https://github.com/engindearing-projects/omniTAK/releases/latest/download/omnitak-installer.sh | sh
```

#### Windows

```powershell
irm https://github.com/engindearing-projects/omniTAK/releases/latest/download/omnitak-installer.ps1 | iex
```

### Manual Installation

If you prefer to manually download and install:

#### 1. Download Release

Visit the [Releases page](https://github.com/engindearing-projects/omniTAK/releases) and download the archive for your platform:

- **Linux x64**: `omnitak-v0.2.0-x86_64-unknown-linux-gnu.tar.gz`
- **Linux ARM64**: `omnitak-v0.2.0-aarch64-unknown-linux-gnu.tar.gz`
- **macOS Intel**: `omnitak-v0.2.0-x86_64-apple-darwin.tar.gz`
- **macOS Apple Silicon**: `omnitak-v0.2.0-aarch64-apple-darwin.tar.gz`
- **Windows x64**: `omnitak-v0.2.0-x86_64-pc-windows-msvc.zip`

#### 2. Verify Checksum (Recommended)

Download the `.sha256` file and verify:

```bash
# Linux/macOS
shasum -a 256 -c omnitak-v0.2.0-x86_64-unknown-linux-gnu.tar.gz.sha256

# Windows PowerShell
$hash = Get-FileHash omnitak-v0.2.0-x86_64-pc-windows-msvc.zip -Algorithm SHA256
$expectedHash = Get-Content omnitak-v0.2.0-x86_64-pc-windows-msvc.zip.sha256
$hash.Hash -eq $expectedHash
```

#### 3. Extract Archive

```bash
# Linux/macOS
tar -xzf omnitak-v0.2.0-*.tar.gz

# Windows
Expand-Archive omnitak-v0.2.0-*.zip
```

#### 4. Install Binaries

**Linux/macOS:**

```bash
# With sudo (system-wide)
sudo install -m 755 omnitak /usr/local/bin/
sudo install -m 755 omnitak-adb-setup /usr/local/bin/

# Without sudo (user-only)
mkdir -p ~/.local/bin
install -m 755 omnitak ~/.local/bin/
install -m 755 omnitak-adb-setup ~/.local/bin/
export PATH="$HOME/.local/bin:$PATH"
```

**Windows:**

```powershell
# Move to a directory in your PATH
Move-Item omnitak.exe "$env:USERPROFILE\bin\"
Move-Item omnitak-adb-setup.exe "$env:USERPROFILE\bin\"

# Add to PATH if needed
$env:PATH += ";$env:USERPROFILE\bin"
```

### Build from Source

For development or the latest features:

#### Prerequisites

- Rust 1.90+ ([install rustup](https://rustup.rs/))
- Protocol Buffers compiler (`protoc`)
- Git

**Install Dependencies:**

```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install -y protobuf-compiler build-essential

# macOS
brew install protobuf

# Windows
choco install protoc
```

#### Build and Install

```bash
# Clone repository
git clone https://github.com/engindearing-projects/omniTAK.git
cd omniTAK

# Build release binaries
cargo build --release

# Install binaries
sudo install -m 755 target/release/omnitak /usr/local/bin/
sudo install -m 755 target/release/omnitak-adb-setup /usr/local/bin/
```

For detailed platform-specific build instructions, see:
- [macOS Setup Guide](../SETUP_MACOS.md)
- [Ubuntu/Linux Setup Guide](../SETUP_UBUNTU.md)
- [Windows Setup Guide](../SETUP_WINDOWS.md)

## Verification

After installation, verify that OmniTAK is working:

```bash
# Check version
omnitak --version
# Expected output: omnitak 0.2.0

# Check ADB tool
omnitak-adb-setup --version
# Expected output: omnitak-adb-setup 0.2.0

# Show help
omnitak --help
```

## Uninstallation

### If installed via installer

```bash
# Remove binaries
sudo rm /usr/local/bin/omnitak
sudo rm /usr/local/bin/omnitak-adb-setup

# Or from user directory
rm ~/.local/bin/omnitak
rm ~/.local/bin/omnitak-adb-setup
```

### If installed via cargo-dist

The cargo-dist installer may provide an uninstall command. Check the installer documentation.

### Clean up configuration (optional)

```bash
# Remove configuration directory
rm -rf ~/.config/omnitak

# Remove certificate directory (if not needed)
rm -rf ~/omnitak/certs
```

## Troubleshooting

### "Command not found" after installation

**Problem**: The binary isn't in your PATH.

**Solution**:

```bash
# Check installation location
which omnitak

# If in ~/.local/bin, add to PATH
echo 'export PATH="$HOME/.local/bin:$PATH"' >> ~/.bashrc
source ~/.bashrc

# For zsh
echo 'export PATH="$HOME/.local/bin:$PATH"' >> ~/.zshrc
source ~/.zshrc
```

### Download fails

**Problem**: Network issues or release doesn't exist.

**Solutions**:

1. Check your internet connection
2. Verify the version exists: https://github.com/engindearing-projects/omniTAK/releases
3. Try downloading manually from the releases page
4. Check if your platform is supported

### Permission denied

**Problem**: No write access to installation directory.

**Solutions**:

```bash
# Use sudo for system-wide install
sudo ./install.sh

# Or install to user directory
./install.sh  # Will automatically use ~/.local/bin if no sudo

# Or manually specify user install
mkdir -p ~/.local/bin
tar -xzf omnitak-*.tar.gz -C ~/.local/bin
```

### Checksum verification fails

**Problem**: Downloaded file is corrupted or tampered with.

**Solutions**:

1. Delete the downloaded file and try again
2. Check your internet connection
3. Try downloading from a different network
4. Report the issue if it persists

### macOS "cannot be opened because the developer cannot be verified"

**Problem**: macOS Gatekeeper blocking unsigned binary.

**Solution**:

```bash
# Remove quarantine attribute
xattr -d com.apple.quarantine /usr/local/bin/omnitak
xattr -d com.apple.quarantine /usr/local/bin/omnitak-adb-setup

# Or allow in System Preferences
# System Preferences > Security & Privacy > General > Allow
```

### Linux: "error while loading shared libraries"

**Problem**: Missing system libraries.

**Solution**:

```bash
# Install required libraries (Ubuntu/Debian)
sudo apt-get install -y libc6 libssl3

# For older distributions
sudo apt-get install -y libc6 libssl1.1
```

### Windows: "VCRUNTIME140.dll not found"

**Problem**: Missing Visual C++ runtime.

**Solution**:

Download and install [Microsoft Visual C++ Redistributable](https://learn.microsoft.com/en-us/cpp/windows/latest-supported-vc-redist)

## Support

If you encounter issues not covered here:

1. Check the [GitHub Issues](https://github.com/engindearing-projects/omniTAK/issues)
2. Review platform-specific guides:
   - [macOS Setup](../SETUP_MACOS.md)
   - [Ubuntu Setup](../SETUP_UBUNTU.md)
   - [Windows Setup](../SETUP_WINDOWS.md)
3. Open a new issue with:
   - Your OS and version
   - Installation method used
   - Complete error message
   - Output of `uname -a` (Linux/macOS)
