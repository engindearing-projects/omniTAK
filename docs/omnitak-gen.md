# omnitak-gen - CoT Message Generator

A command-line tool for generating test Cursor on Target (CoT) messages in XML and binary formats for testing TAK servers and omniTAK aggregators.

## Features

- **Multiple Output Formats**: XML, TAK Protocol Version 1 Mesh, and TAK Protocol Version 1 Stream
- **All MIL-STD-2525D Affiliations**: Pending, Unknown, Assumed Friend, Friendly, Neutral, Suspect, Hostile
- **Entity Types**: Ground units, Air units, Sea vessels
- **Batch Generation**: Generate multiple messages with incremental coordinates
- **Network Transmission**: Send messages directly to TAK servers via UDP, TCP, or TLS
- **Realistic Metadata**: Auto-generated UUIDs, timestamps, and stale times
- **Configurable Movement**: Set speed, course, and altitude

## Installation

Build the tool from the omniTAK project root:

```bash
cargo build --bin omnitak-gen --release
```

The binary will be located at `target/release/omnitak-gen`.

## Usage

### Basic Syntax

```bash
omnitak-gen --lat <LAT> --lon <LON> [OPTIONS]
```

### Options

| Option | Description | Default |
|--------|-------------|---------|
| `--lat <LAT>` | Latitude in decimal degrees | **Required** |
| `--lon <LON>` | Longitude in decimal degrees | **Required** |
| `--alt <ALT>` | Altitude in meters (HAE) | 0.0 |
| `--callsign <CALLSIGN>` | Callsign/name for entity | Auto-generated |
| `--uid <UID>` | Unique ID | Auto-generated UUID |
| `--affiliation <AFF>` | Affiliation type | friendly |
| `--entity <TYPE>` | Entity type | ground |
| `--speed <SPEED>` | Speed in m/s | 0.0 |
| `--course <COURSE>` | Course/heading (0-360) | 0.0 |
| `--stale <MINUTES>` | Stale time in minutes | 5 |
| `--format <FORMAT>` | Output format | xml |
| `-o, --output <FILE>` | Output file | stdout |
| `--batch <COUNT>` | Generate multiple messages | 1 |
| `--interval <MS>` | Interval between messages | 1000 |
| `--send` | Send to TAK server | false |
| `--server <HOST:PORT>` | TAK server address | localhost:8087 |
| `--protocol <PROTO>` | Protocol (udp/tcp/tls) | udp |
| `-v, --verbose` | Verbose output | false |

### Affiliation Types

- `pending` - Gray - Classification in progress
- `unknown` - Yellow - Identity not determined
- `assumed-friend` - Amber - Likely friendly
- `friendly` - Cyan - Confirmed friendly
- `neutral` - Green - Non-combatant
- `suspect` - Dark Orange - Suspicious
- `hostile` - Red - Confirmed threat

### Entity Types

- `ground` - Ground Equipment Vehicle (G-E-V)
- `air` - Air Military Fixed Wing (A-M-F)
- `sea` - Sea Surface Ship (S-S-F)

### Output Formats

- `xml` - Standard CoT XML format
- `mesh` - TAK Protocol Version 1 Mesh format (binary)
- `stream` - TAK Protocol Version 1 Stream format (binary)

## Examples

### Generate a Friendly Ground Unit

```bash
omnitak-gen --lat=37.7749 --lon=-122.4194 --callsign="UNIT-1"
```

Output:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<event version="2.0" uid="omnitak-gen-..." type="a-f-G-E-V" how="m-g" ...>
  <point lat="37.7749" lon="-122.4194" hae="0" ce="9999999" le="9999999"/>
  <detail>
    <contact callsign="UNIT-1"/>
    <track speed="0" course="0"/>
    <remarks>Generated by omnitak-gen - Friendly</remarks>
  </detail>
</event>
```

### Generate a Hostile Aircraft with Movement

```bash
omnitak-gen \
  --lat=37.7749 \
  --lon=-122.4194 \
  --affiliation=hostile \
  --entity=air \
  --alt=1500 \
  --speed=75 \
  --course=180 \
  --callsign="BOGEY-1"
```

This generates a hostile aircraft at 1500m altitude, traveling at 75 m/s on a southerly heading.

### Generate 10 Units in a Line

```bash
omnitak-gen \
  --lat=37.7749 \
  --lon=-122.4194 \
  --batch=10 \
  --format=xml \
  -o units.xml
```

This generates 10 friendly ground units spaced ~111 meters apart (0.001Â° latitude increment).

### Generate Binary Messages (TAK Protocol)

```bash
# Mesh format
omnitak-gen \
  --lat=37.7749 \
  --lon=-122.4194 \
  --format=mesh \
  -o message.bin

# Stream format
omnitak-gen \
  --lat=37.7749 \
  --lon=-122.4194 \
  --format=stream \
  -o message.bin
```

Binary format structure:
- 4 bytes: Magic number (0xbf01bf01 for mesh, 0xbfbfbfbf for stream)
- 4 bytes: Payload length (little-endian)
- N bytes: XML payload

### Send Directly to TAK Server

```bash
# Send via UDP
omnitak-gen \
  --lat=37.7749 \
  --lon=-122.4194 \
  --send \
  --server=192.168.1.100:8087 \
  --protocol=udp

# Send via TCP
omnitak-gen \
  --lat=37.7749 \
  --lon=-122.4194 \
  --send \
  --server=192.168.1.100:8087 \
  --protocol=tcp
```

### Generate Suspect Sea Vessel

```bash
omnitak-gen \
  --lat=37.7749 \
  --lon=-122.4194 \
  --affiliation=suspect \
  --entity=sea \
  --callsign="VESSEL-007" \
  --speed=5 \
  --course=270
```

### Batch Generation with Sending

```bash
omnitak-gen \
  --lat=37.7749 \
  --lon=-122.4194 \
  --batch=100 \
  --interval=500 \
  --send \
  --server=localhost:8087 \
  --verbose
```

This generates 100 messages sent every 500ms to the local TAK server.

## CoT Type Field Format

Generated CoT types follow MIL-STD-2525D format: `a-<affiliation>-<dimension>-<function>`

Examples:
- `a-f-G-E-V` - Friendly Ground Equipment Vehicle
- `a-h-A-M-F` - Hostile Air Military Fixed Wing
- `a-s-S-S-F` - Suspect Sea Surface Ship

## Testing with omniTAK

You can use omnitak-gen to test omniTAK's filtering and routing capabilities:

```bash
# Terminal 1: Start omniTAK
cargo run --release

# Terminal 2: Generate test messages
omnitak-gen --lat=37.7749 --lon=-122.4194 --send
omnitak-gen --lat=37.7749 --lon=-122.4194 --affiliation=hostile --send
omnitak-gen --lat=37.7749 --lon=-122.4194 --entity=air --send
```

## Known Limitations

- TLS protocol support not yet implemented (use TCP or UDP)
- Binary formats wrap XML payload (not true protobuf encoding yet)
- Batch generation increments latitude only (spreads units north-south)
- No support for complex detail fields beyond callsign, track, and remarks

## Future Enhancements

- Full protobuf encoding for binary formats
- TLS/SSL support with certificate authentication
- More entity types and detailed MIL-STD-2525D symbols
- Support for custom detail fields via JSON/YAML
- Batch generation patterns (line, grid, circle)
- Live tracking mode with GPS simulation
- Integration with ATAK for real-time testing

## See Also

- [omniTAK README](../README.md)
- [MIL-STD-2525D Documentation](https://www.assistdocs.com/)
- [TAK Protocol Specification](https://tak.gov/)
